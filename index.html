<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr3vMedia SYNTH-O Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* --- CORE NEON STYLES --- */
        :root {
            --bg-dark: #0F1117;
            --neon-green: #00FF66;
            --neon-glow: 0 0 8px var(--neon-green), 0 0 15px var(--neon-green);
            --card-bg: #1B1E28;
            --text-light: #E0E0E0;
            --secondary-dark: #12151d;
            
            /* SYNTH-O Colors */
            --synth-red: #E74C3C;
            --synth-blue: #3498DB;
            --synth-green: #2ECC71;
            --synth-yellow: #F1C40F;
            --synth-wild: #34495E;
            
            /* TCG Rarity Colors */
            --rarity-legendary: #ffc107;
        }

        body {
            font-family: 'Share Tech Mono', monospace, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; 
            background-color: var(--bg-dark);
            color: var(--neon-green);
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-shadow: var(--neon-glow);
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        /* --- GENERAL UI & MODAL STYLES (Unchanged/Simplified) --- */
        .header-controls { display: flex; gap: 15px; margin-bottom: 20px; }
        .ui-button, .controls button, .pack-button { /* ... existing button styles ... */ }
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); display: flex; justify-content: center;
            align-items: center; z-index: 1000; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--card-bg); padding: 30px; border-radius: 12px;
            border: 2px solid var(--neon-green); box-shadow: var(--neon-glow);
            width: 90%; max-width: 900px; color: var(--text-light);
            max-height: 90vh; overflow-y: auto;
        }

        /* --- SYNTH-O GAME BOARD STYLES (NEW) --- */
        #synthOBoard {
            display: grid;
            grid-template-areas: 
                "log log"
                "center board"
                "hand hand";
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            min-height: 70vh;
        }
        .game-log { grid-area: log; background: var(--secondary-dark); padding: 10px; border-radius: 6px; font-size: 0.8em; max-height: 80px; overflow-y: auto; border: 1px solid var(--neon-green); }
        .center-area { grid-area: center; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .board-info { grid-area: board; background: var(--secondary-dark); padding: 15px; border-radius: 6px; border: 1px solid var(--neon-green); }
        .player-hand { grid-area: hand; display: flex; justify-content: flex-start; gap: 10px; padding-top: 20px; border-top: 1px dashed var(--neon-green); overflow-x: auto; max-width: 100%; }

        /* SYNTH-O Card Styling */
        .synth-card {
            width: 80px;
            height: 120px;
            border-radius: 8px;
            border: 3px solid var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            color: var(--text-light);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
            transition: transform 0.1s;
            cursor: pointer;
            flex-shrink: 0; /* Important for horizontal scrolling hand */
        }

        /* Color classes */
        .color-R { background-color: var(--synth-red); border-color: var(--synth-red); }
        .color-B { background-color: var(--synth-blue); border-color: var(--synth-blue); }
        .color-G { background-color: var(--synth-green); border-color: var(--synth-green); }
        .color-Y { background-color: var(--synth-yellow); border-color: var(--synth-yellow); }
        .color-W { background-color: var(--synth-wild); color: var(--neon-green); border-color: var(--neon-green); }
        .deck-card { background-color: var(--synth-wild); border-color: var(--neon-green); color: var(--neon-green); }
        
        .synth-card:hover { transform: translateY(-5px); }
        .synth-card.playable { border: 3px solid var(--neon-green) !important; box-shadow: 0 0 15px var(--neon-green) !important; }
        .synth-card.non-playable { opacity: 0.5; cursor: default; }

        /* Discard Pile */
        #discardPile { 
            position: relative; 
            width: 100px; 
            height: 140px; 
            border: 2px dashed var(--text-light); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        #discardPile .synth-card {
            position: absolute;
            width: 100px;
            height: 140px;
            transform: rotate(2deg);
        }
    </style>
</head>
<body>

    <header>
        <h1>TR3VMEDIA // SYNTH-O TERMINAL</h1>
        <div class="header-controls">
            <button id="customizeBtn" class="ui-button">‚öôÔ∏è Custom Card</button>
            <button id="viewCollectionBtn" class="ui-button">üé¥ Collection</button>
            <button id="openPackBtn" class="pack-button">‚ö° Open Pack</button>
            <button id="playSynthOBtn" class="ui-button">üéÆ Play SYNTH-O</button>
            <button id="loginBtn" class="ui-button">üîì Login/Logout</button>
        </div>
    </header>

    <div class="swipe-area">
        </div>

    <div id="synthOModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 90vw;">
            <h2 id="synthOTitle">SYNTH-O: Initiate Sequence</h2>
            <div id="synthOBoard">
                
                <div class="game-log">
                    <p>SYSTEM LOG:</p>
                    <div id="logContent">Game initialized. Drawing hands...</div>
                </div>

                <div class="center-area">
                    <div id="drawDeck" class="synth-card deck-card" onclick="drawCard()">DECK</div>
                    
                    <div style="margin-top: 20px;">
                        <p style="color: var(--text-light); margin-bottom: 5px;">DISCARD PILE</p>
                        <div id="discardPile">
                            </div>
                    </div>
                </div>

                <div class="board-info">
                    <h3>GAME STATE</h3>
                    <p>Current Player: <strong id="currentPlayerName">User</strong></p>
                    <p>Turn Direction: <strong id="direction">CLOCKWISE (‚Üí)</strong></p>
                    <p>Required Color: <strong id="requiredColor" style="color: var(--neon-green);">Any</strong></p>
                    <p>Required Value: <strong id="requiredValue" style="color: var(--neon-green);">Any</strong></p>
                    <p>Hand Count (AI): <strong id="aiHandCount">0</strong></p>
                    <button class="ui-button" onclick="saySynthO()">SAY SYNTH-O</button>
                    <button class="ui-button" onclick="closeSynthOModal()" style="float: right;">EXIT GAME</button>
                </div>

                <div class="player-hand">
                    </div>
            </div>
        </div>
    </div>


    <script>
        // --- JAVASCRIPT LOGIC (UNO/SYNTH-O Game) ---

        // Card definition structure: Color, Value (0-9, S, R, D2, W, W4)
        const COLORS = ['R', 'B', 'G', 'Y'];
        const VALUES = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'S', 'R', 'D2'];
        const WILD_CARDS = ['W', 'W4'];

        let gameDeck = [];
        let discardPile = [];
        let playerHand = [];
        let aiHand = [];

        // Game State Variables
        let isGameRunning = false;
        let currentPlayer = 'User'; // Simple state for now
        let currentDirection = 1; // 1 for Clockwise (default), -1 for Counter-Clockwise
        
        const logContent = document.getElementById('logContent');

        function log(message) {
            logContent.innerHTML += `<p>>> ${message}</p>`;
            logContent.scrollTop = logContent.scrollHeight; // Scroll to bottom
        }

        // --- DECK INITIALIZATION ---
        function createDeck() {
            let deck = [];
            // Numbers 1-9 (two of each per color)
            COLORS.forEach(color => {
                deck.push({ color: color, value: '0' }); // One '0' per color
                for (let i = 1; i <= 9; i++) {
                    deck.push({ color: color, value: String(i) });
                    deck.push({ color: color, value: String(i) });
                }
                // Action Cards (two of each per color)
                ['S', 'R', 'D2'].forEach(value => {
                    deck.push({ color: color, value: value });
                    deck.push({ color: color, value: value });
                });
            });
            // Wild Cards (four of each)
            WILD_CARDS.forEach(value => {
                for (let i = 0; i < 4; i++) {
                    deck.push({ color: 'W', value: value });
                }
            });
            return shuffleDeck(deck);
        }

        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        function drawCardFromDeck(hand) {
            if (gameDeck.length === 0) {
                // If the deck runs out, shuffle the discard pile back in (except the top card)
                const topCard = discardPile.pop();
                gameDeck = shuffleDeck(discardPile);
                discardPile = [topCard];
                log("Deck empty. Reshuffling discard pile into the deck.");
            }
            const card = gameDeck.pop();
            hand.push(card);
            return card;
        }

        function renderCard(card, index, isPlayable = false) {
            let displayValue = card.value;
            // Map action card values to symbols
            switch(card.value) {
                case 'S': displayValue = '√ò'; break; // Skip
                case 'R': displayValue = '‚áå'; break; // Reverse
                case 'D2': displayValue = '+2'; break; // Draw Two
                case 'W': displayValue = 'WILD'; break; // Wild
                case 'W4': displayValue = '+4'; break; // Wild Draw Four
            }

            const cardElement = document.createElement('div');
            cardElement.className = `synth-card color-${card.color} ${isPlayable ? 'playable' : 'non-playable'}`;
            cardElement.textContent = displayValue;
            cardElement.dataset.index = index;
            
            if (isPlayable) {
                cardElement.onclick = () => playCard(index);
            }

            return cardElement;
        }

        // --- GAME PLAY LOGIC ---

        function isCardPlayable(card, topCard) {
            // Wild cards are always playable
            if (card.color === 'W') return true;

            // Must match color or value
            return card.color === topCard.color || card.value === topCard.value;
        }

        function updateHandDisplay() {
            const handContainer = document.querySelector('.player-hand');
            const topCard = discardPile[discardPile.length - 1];
            handContainer.innerHTML = '';
            
            playerHand.forEach((card, index) => {
                const playable = isCardPlayable(card, topCard);
                const cardElement = renderCard(card, index, playable);
                handContainer.appendChild(cardElement);
            });
            document.getElementById('aiHandCount').textContent = aiHand.length;
        }

        function updateDiscardPile() {
            const pileContainer = document.getElementById('discardPile');
            const topCard = discardPile[discardPile.length - 1];
            pileContainer.innerHTML = '';
            
            if (topCard) {
                const cardElement = renderCard(topCard, -1, false);
                cardElement.style.cursor = 'default';
                pileContainer.appendChild(cardElement);

                // Update required color/value display
                document.getElementById('requiredColor').textContent = topCard.color === 'W' ? topCard.selectedColor || 'Wild' : topCard.color;
                document.getElementById('requiredValue').textContent = topCard.value;
            }
        }
        
        function drawCard() {
            if (currentPlayer !== 'User') {
                 log("It's not your turn.");
                 return;
            }

            const topCard = discardPile[discardPile.length - 1];
            const canPlay = playerHand.some(card => isCardPlayable(card, topCard));

            if (canPlay) {
                log("You have a playable card. You must play or pass (not implemented yet).");
                return;
            }

            const newCard = drawCardFromDeck(playerHand);
            log(`Drew a card: ${newCard.color}-${newCard.value}.`);
            
            // Allow playing the drawn card immediately if it's playable
            if (isCardPlayable(newCard, topCard)) {
                 log("Drawn card is playable.");
            } else {
                 log("Drawn card is not playable. Next turn (AI turn not implemented).");
            }
            updateHandDisplay();
            // In a full game, we'd switch to the AI here: nextTurn();
        }

        function playCard(index) {
            const card = playerHand[index];
            const topCard = discardPile[discardPile.length - 1];

            if (!isCardPlayable(card, topCard)) {
                log("Invalid move: Card does not match color or value.");
                return;
            }

            // Remove card from hand
            playerHand.splice(index, 1);
            
            // Handle Wild Card selection (Mocked)
            if (card.color === 'W') {
                // In a real game, this would open a color selection modal.
                // For the demo, we'll arbitrarily pick the next color.
                const nextColor = COLORS[Math.floor(Math.random() * COLORS.length)];
                card.selectedColor = nextColor;
                log(`Played WILD card. Next color is set to ${nextColor}.`);
            }

            // Move to discard pile
            discardPile.push(card);
            log(`User played ${card.color}-${card.value}. Hand size: ${playerHand.length}`);

            // Update UI
            updateDiscardPile();
            updateHandDisplay();
            
            // Check for Win
            if (playerHand.length === 0) {
                alert("CONGRATULATIONS! You won SYNTH-O!");
                closeSynthOModal();
                return;
            }

            // Handle Action Card effects (Not fully implemented, just logging)
            if (card.value === 'S') log("Next player skipped.");
            if (card.value === 'R') { 
                currentDirection *= -1; 
                document.getElementById('direction').textContent = currentDirection === 1 ? 'CLOCKWISE (‚Üí)' : 'COUNTER-CLOCKWISE (‚Üê)';
                log("Direction reversed.");
            }
            if (card.value === 'D2') log("Next player must draw 2.");
            if (card.value === 'W4') log("Next player must draw 4.");

            // nextTurn(); (Switch to AI)
        }
        
        // --- GAME CONTROL ---

        function initSynthOGame() {
            gameDeck = createDeck();
            discardPile = [];
            playerHand = [];
            aiHand = [];
            logContent.innerHTML = 'Game initialized. Drawing hands...';

            // Draw initial hands (7 cards each)
            for (let i = 0; i < 7; i++) {
                drawCardFromDeck(playerHand);
                drawCardFromDeck(aiHand); // Mock AI hand size
            }

            // Flip the first card (must not be a Wild Draw Four)
            let firstCard;
            do {
                firstCard = gameDeck.pop();
                if (firstCard.value === 'W4') {
                    // Put it back and shuffle again
                    gameDeck.unshift(firstCard);
                    gameDeck = shuffleDeck(gameDeck);
                }
            } while (firstCard.value === 'W4');
            
            // If the first card is a standard Wild, it resolves immediately to a random color
            if (firstCard.color === 'W') {
                const nextColor = COLORS[Math.floor(Math.random() * COLORS.length)];
                firstCard.selectedColor = nextColor;
                log(`First card is WILD. Color set to ${nextColor}.`);
            }

            discardPile.push(firstCard);
            
            // Update UI
            updateDiscardPile();
            updateHandDisplay();
            isGameRunning = true;
            log(`Game ready. Player hand: ${playerHand.length}. Top card: ${firstCard.color}-${firstCard.value}`);
        }

        function saySynthO() {
            if (playerHand.length === 2) {
                alert("SYNTH-O declared! (Would prevent the next player from calling you out)");
            } else {
                alert("You can only declare SYNTH-O when you have 2 cards left.");
            }
        }
        
        function openSynthOModal() {
            if (!isGameRunning) {
                initSynthOGame();
            }
            document.getElementById('synthOModal').style.display = 'flex';
        }
        
        function closeSynthOModal() {
            isGameRunning = false;
            document.getElementById('synthOModal').style.display = 'none';
            // In a full game, you might prompt to save the game state here
        }

        document.getElementById('playSynthOBtn').addEventListener('click', openSynthOModal);

        // --- (EXISTING TCG/PROFILE LOGIC BELOW, SIMPLIFIED) ---

        // TCG MOCK DATA (Required for Profile Console/Collection buttons to not break)
        const PACK_CARD_POOL = [ /* ... TCG cards ... */ ]; 
        let userCardsCollected = JSON.parse(localStorage.getItem('tcgCollection')) || [];
        let isUserLoggedIn = false;
        
        let userCardData = JSON.parse(localStorage.getItem('userCard')) || {
            id: 'user_custom', title: "My Custom Media Card", user: "@Guest", birthday: '2000-01-01', 
            description: "Default card.", bio: "Default bio.",
            imageUrl: "https://picsum.photos/320/280?user=tr3vmedia",
            mediaType: 'image', fullUrl: 'https://picsum.photos/600/400?user=tr3vmedia',
            rarity: 'Starter', type: 'Profile', power: 70 
        };
        if (!userCardsCollected.find(c => c.id === 'user_custom')) { userCardsCollected.push(userCardData); }


        // --- DUMMY FUNCTIONS TO PREVENT ERRORS ---
        function updateCollectionCount() { /* ... */ }
        function openCollectionModal() { alert("Viewing TCG Collection."); }
        function openPack() { alert("Opening TCG Pack."); }
        function updateLoginState() { /* ... */ }
        function init() {
            updateLoginState('@Guest', false);
            updateCollectionCount();
            // NOTE: The main UI (swipe, profile console) HTML is omitted, but the JS references remain.
            // In a production environment, you'd ensure the profileConsole HTML structure is present.
        }
        
        // --- EVENT LISTENERS FOR MODALS/CONTROLS ---
        document.getElementById('viewCollectionBtn').addEventListener('click', openCollectionModal);
        document.getElementById('openPackBtn').addEventListener('click', openPack);
        
        init();

    </script>
</body>
</html>
