<?php
// index.php
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUO UP Profiles & Friends</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
<style>
/* --- Base styles --- */
body { margin:0; font-family:'Orbitron',sans-serif; background:#0b0b0b; color:white; }
.container { width:90%; max-width:1000px; margin:auto; padding:20px; }
.hidden { display:none !important; }
/* Header */
.header { background:#111; border-bottom:3px solid cyan; box-shadow:0 0 20px rgba(0,255,255,0.5); padding:10px 0; margin-bottom:20px; display:flex; align-items:center; justify-content:center; }
.header h1 { font-size:2.5em; color:#fff; text-shadow:0 0 5px cyan,0 0 10px cyan,0 0 15px magenta; margin:0; }
.icon-container { margin-right:15px; font-size:2.5em; color:cyan; text-shadow:0 0 5px cyan,0 0 10px magenta; }
/* Buttons */
.neon-btn { border:2px solid cyan; background:transparent; color:white; padding:8px 14px; margin:5px; border-radius:6px; cursor:pointer; box-shadow:0 0 10px cyan; transition:all 0.2s ease-in-out; text-transform:uppercase; font-family:'Orbitron',sans-serif; }
.neon-btn:hover { border-color:magenta; box-shadow:0 0 15px magenta; transform: translateY(-1px); }
.neon-btn:disabled { border-color:#555; box-shadow:none; color:#555; cursor:not-allowed; }
.neon-btn.add { border-color:lime; box-shadow:0 0 10px lime; }
.neon-btn.add:hover { border-color:green; box-shadow:0 0 15px green; }
.neon-btn.remove { border-color:red; box-shadow:0 0 10px red; }
.neon-btn.remove:hover { border-color:orange; box-shadow:0 0 15px orange; }
.neon-btn.pending { border-color:yellow; box-shadow:0 0 10px yellow; color:yellow; cursor:default; }
/* Input fields */
input[type="text"], input[type="number"], textarea, select { flex-grow:1; padding:10px; border:1px solid cyan; background:#181818; color:white; border-radius:6px; font-family:inherit; outline:none; transition:border-color 0.2s, box-shadow 0.2s; }
input:focus, textarea:focus, select:focus { border-color: magenta; box-shadow: 0 0 8px magenta; }
textarea { resize: vertical; }
/* Cards */
.card-container { display:flex; flex-wrap:wrap; gap:20px; justify-content:center; padding-top: 10px; }
.card { width: 100%; max-width:300px; padding:20px; border:3px solid transparent; border-radius:8px; background:#181818; box-shadow:0 0 15px rgba(0,255,255,0.4), inset 0 0 5px rgba(0,255,255,0.2); border-image-source: linear-gradient(45deg, cyan, magenta, cyan); border-image-slice:1; display:flex; flex-direction:column; align-items:center; cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; }
.card:hover { transform: translateY(-5px); box-shadow:0 0 30px magenta, inset 0 0 10px rgba(255,0,255,0.5); }
.card-content-box { display:flex; flex-direction:column; align-items:center; width:100%; margin-bottom:15px; padding-bottom:15px; border-bottom:1px dashed #333; }
.avatar { width:80px; height:80px; border-radius:50%; border:4px solid magenta; object-fit:cover; margin-bottom:15px; }
.skill-rating { color:gold; font-size:1.4em; margin-bottom:10px; }
.status-indicator { font-size:0.9em; padding:4px 10px; border-radius:4px; font-weight:bold; margin-bottom:10px; text-transform:uppercase; }
.status-online { background-color:#00cc00; color:#0b0b0b; box-shadow:0 0 5px #00ff00; }
.status-ingame { background-color:#ffaa00; color:#0b0b0b; box-shadow:0 0 5px #ffaa00; }
.status-lfd { background-color:#00aaff; color:#0b0b0b; box-shadow:0 0 5px #00aaff; }
/* Nav */
#navigationBar { display:flex; justify-content:center; flex-wrap:wrap; padding:10px; background:#151515; border-radius:8px; margin-bottom:30px; border:1px solid #333; }
#searchControls { display:flex; gap:15px; margin-bottom:20px; align-items:center; flex-wrap:wrap; background:#1a1a1a; padding:15px; border-radius:8px; border:1px solid #004444; }
/* Messaging */
#messagingTab { display:flex; gap:20px; height:75vh; }
#chatList { width:300px; padding:15px; border:2px solid cyan; border-radius:8px; background:#1a1a1a; overflow-y:auto; }
#activeDuoList { margin-top:10px; }
.chat-entry { padding:10px; border-bottom:1px dashed #333; cursor:pointer; transition: background 0.2s; }
.chat-entry:hover { background:#2a2a2a; }
.chat-entry.active { background:#004444; border-left:5px solid lime; font-weight:bold; }
#chatWindow { flex-grow:1; display:flex; flex-direction:column; border:2px solid magenta; border-radius:8px; background:#1a1a1a; }
#chatHeader { padding:10px; border-bottom:2px solid magenta; margin:0; background:#330033; }
#messageDisplay { flex-grow:1; padding:15px; overflow-y:auto; display:flex; flex-direction:column; gap:15px; }
.message { max-width:70%; padding:10px 15px; border-radius:18px; font-size:0.95em; }
.message.sent { background:#005555; align-self:flex-end; border-bottom-right-radius:5px; }
.message.received { background:#333333; align-self:flex-start; border-bottom-left-radius:5px; }
#messageInputArea { padding:10px; border-top:2px solid magenta; background:#0b0b0b; display:flex; gap:10px; }
/* Profile view */
#viewProfileContent { padding:30px; border:3px solid magenta; border-radius:12px; background:#1a1a1a; margin-top:20px; display:flex; flex-direction:column; align-items:center; }
.profile-stat { width:100%; max-width:400px; display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px dashed #333; margin-bottom:5px; }
.profile-stat span:first-child { color: cyan; font-weight:bold; }
.profile-stat span:last-child { text-align:right; }
</style>
</head>
<body>
<div class="header"><div class="icon-container">⚡</div><h1>DUO UP (Direct)</h1></div>

<!-- Login -->
<div id="loginPage" class="container">
<p style="text-align:center;">Find your perfect partner and dominate the cyber-arena.</p>
<div style="text-align:center;">
<button class="neon-btn" onclick="login()">Login with Google</button>
</div>
</div>

<!-- Dashboard -->
<div id="dashboard" class="container hidden">
<h2 id="welcome"></h2>
<div id="navigationBar">
<button class="neon-btn" onclick="showTab('allUsers')">Suggested</button>
<button class="neon-btn" onclick="showTab('search')">Find Players</button>
<button class="neon-btn" onclick="showTab('friends')">Duos</button>
<button class="neon-btn" onclick="showTab('messaging')">Messaging</button>
<button class="neon-btn" onclick="showTab('profile')">Profile</button>
<button class="neon-btn" onclick="logout()">Logout</button>
</div>

<div id="allUsersTab" class="card-container"></div>

<div id="searchTab" class="hidden container">
<h2>Player Search Filter</h2>
<div id="searchControls">
<input type="text" id="searchInput" placeholder="Search by Nickname or Bio..." onkeyup="filterSearchResults()">
<label style="color:cyan; margin-left:15px;">Status:</label>
<select id="statusFilter" onchange="filterSearchResults()">
<option value="">Any Status</option>
<option value="Online">Online</option>
<option value="In Game">In Game</option>
<option value="LFD">Looking For Duo (LFD)</option>
</select>
</div>
<div id="searchResults" class="card-container"></div>
</div>

<div id="friendsTab" class="container hidden"></div>

<div id="messagingTab" class="hidden">
<div id="chatList">
<h3>Active Duos</h3>
<div id="activeDuoList">No Duos yet.</div>
</div>
<div id="chatWindow">
<h3 id="chatHeader">Select a Duo to start messaging</h3>
<div id="messageDisplay"></div>
<div id="messageInputArea" class="hidden">
<input type="text" id="messageInput" placeholder="Type your message..." onkeyup="if(event.key==='Enter') sendMessage()">
<button class="neon-btn" id="sendMessageBtn" onclick="sendMessage()">Send</button>
</div>
</div>
</div>

<div id="viewProfileTab" class="hidden container">
<button class="neon-btn" onclick="showTab('allUsers')">← Back to Suggested</button>
<div id="viewProfileContent"></div>
</div>

<div id="profileTab" class="hidden container">
<h2>Cyber-Profile Editor</h2>
<div style="padding:20px; border:2px solid magenta; border-radius:10px; background:#1a1a1a;">
<div style="display:flex; align-items:center; margin-bottom:20px;">
<img id="profileAvatar" class="avatar" src="" style="width:80px;height:80px;margin-right:20px;border-color:cyan;">
<div>
<label style="color: cyan; display:block; margin-bottom:5px;">Unique Identifier:</label>
<input type="text" id="profileNickname" value="User Nickname" disabled>
</div>
</div>
<p style="color: yellow; font-size:0.9em;">(Avatar upload and username editor are simplified.)</p>
<div style="margin-bottom:15px;">
<label style="color: cyan; display:block; margin-bottom:5px;">Bio/Tagline:</label>
<textarea id="profileBio" rows="3" style="width:100%;"></textarea>
</div>
<div style="display:flex; gap:30px; margin-bottom:20px; flex-wrap:wrap;">
<div>
<label style="color: cyan; display:block; margin-bottom:5px;">Skill Rating (1-5):</label>
<input id="profileSkillRating" type="number" min="1" max="5">
</div>
<div>
<label style="color: cyan; display:block; margin-bottom:5px;">Current Status:</label>
<select id="profileStatus">
<option value="Online">Online</option>
<option value="In Game">In Game</option>
<option value="LFD">Looking For Duo (LFD)</option>
</select>
</div>
</div>
<button class="neon-btn" style="border-color:#00ff00; box-shadow:0 0 10px #00ff00;" onclick="saveProfile()">Save Profile</button>
<p id="saveMessage" style="color:#00ff00; margin-top:10px;"></p>
</div>
</div>

<script>
// ---------------------------
// Firebase Init
const firebaseConfig = {
apiKey:"YOUR_API_KEY",
authDomain:"YOUR_AUTH_DOMAIN",
projectId:"YOUR_PROJECT_ID",
storageBucket:"YOUR_STORAGE_BUCKET",
messagingSenderId:"YOUR_MESSAGING_ID",
appId:"YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

const DEFAULT_AVATAR = "https://cdn-icons-png.flaticon.com/512/149/149071.png";

let currentUser=null;
let currentProfileData={};
let allUsersCache=[];
let friendProfiles={};
let currentChatUid=null;
let chatListener=null;

// ---------------------------
// Authentication
function login(){ auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
function logout(){ if(chatListener) chatListener(); auth.signOut(); }

// ---------------------------
// Tab switching
function showTab(tab){
document.querySelectorAll('#allUsersTab,#searchTab,#friendsTab,#messagingTab,#profileTab,#viewProfileTab').forEach(e=>e.classList.add('hidden'));
if(tab!=='messaging' && chatListener){ chatListener(); chatListener=null; currentChatUid=null; }
switch(tab){
case 'allUsers': loadAllUsers(); break;
case 'search': filterSearchResults(); break;
case 'friends': loadFriends(); break;
case 'messaging': loadChatList(); break;
case 'profile': loadUserProfile(); break;
default: break;
}
document.getElementById(tab+'Tab')?.classList.remove('hidden');
}

// ---------------------------
// Load Users
async function loadAllUsers(){
if(!currentUser) return;
const container=document.getElementById('allUsersTab');
container.innerHTML="<h3>Suggested Players</h3>";
try{
const snapshot=await db.collection('users').get();
allUsersCache=snapshot.docs.map(d=>({id:d.id,...d.data()}));
allUsersCache.forEach(user=>{
if(user.id===currentUser.uid) return;
const card=renderUserCard(user.id,user);
if(card) container.appendChild(card);
});
}catch(e){ container.innerHTML+=`<p style="color:red;">Error loading users: ${e.message}</p>`; }
}

// Render Card
function renderUserCard(uid,data){
if(!data) return null;
const card=document.createElement('div'); card.className='card';
card.onclick=()=>viewProfile(uid);
const statusClass=(data.status||'Online').replace(/\s/g,'').toLowerCase();
card.innerHTML=`
<div class="card-content-box">
<img src="${data.profileImageUrl||DEFAULT_AVATAR}" class="avatar">
<h3 style="margin:0;">${data.username?`@${data.username}`:data.nickname||'Unknown'}</h3>
<div class="skill-rating">${'⭐'.repeat(data.skillRating||3)}</div>
<div class="status-indicator status-${statusClass}">${data.status||'Online'}</div>
<p style="margin:5px 0; font-size:0.9em; text-align:center; color:#ccc;">${data.bio||'No bio provided.'}</p>
</div>
<button class="neon-btn add" onclick="event.stopPropagation(); sendFriendRequest('${uid}')">Send Request</button>
`;
return card;
}

// ---------------------------
// Friend Request
async function sendFriendRequest(uid){
if(!currentUser) return;
const id=`${currentUser.uid}_${uid}`;
try{
await db.collection('requests').doc(id).set({senderId:currentUser.uid,receiverId:uid,status:'pending',sentAt:firebase.firestore.FieldValue.serverTimestamp()});
alert("Request sent!");
loadAllUsers();
filterSearchResults();
}catch(e){ console.error(e); alert("Failed to send request. Check rules."); }
}

// ---------------------------
// Auth listener
auth.onAuthStateChanged(async user=>{
if(!user){ document.getElementById('loginPage').classList.remove('hidden'); document.getElementById('dashboard').classList.add('hidden'); return;}
document.getElementById('loginPage').classList.add('hidden'); document.getElementById('dashboard').classList.remove('hidden');
currentUser=user;
const uRef=db.collection('users').doc(user.uid); const uDoc=await uRef.get();
if(!uDoc.exists){
await uRef.set({nickname:user.displayName,profileImageUrl:user.photoURL,friends:[],bio:'New Cyber Warrior!',skillRating:3,status:'Online'});
}
currentProfileData=(await uRef.get()).data();
document.getElementById('welcome').textContent=`Welcome, ${currentProfileData.nickname||user.displayName}`;
showTab('allUsers');
});
</script>

</body>
</html>
