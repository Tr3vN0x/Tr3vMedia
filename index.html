<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DuoUp - Find Your Gaming Partner</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Orbitron:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root {
  --bg-primary:#1A1A2E;
  --bg-secondary:#24263B;
  --accent-cyan:#00FFFF;
  --text-light:#F0F0F0;
  --text-muted:#A0AEC0;
  --card-color:#ffffff;
  --font-main:'Rajdhani',sans-serif;
  --font-header:'Orbitron',sans-serif;
  --status-online:#38A169;
}

body { margin:0; font-family:var(--font-main); background:var(--bg-primary); color:var(--text-light); min-height:100vh; }

h1,h2,h3 {font-family:var(--font-header); margin:0;}
a {color:var(--accent-cyan); text-decoration:none;}
button { cursor:pointer; border:none; border-radius:5px; }

#auth-section, #app-section { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; }

form { display:flex; flex-direction:column; background:var(--bg-secondary); padding:20px; border-radius:8px; margin:10px; width:300px; }
input, select { margin:8px 0; padding:10px; border-radius:5px; border:none; }
button { margin-top:10px; padding:10px; font-weight:bold; }

.google-btn { background:#DB4437; color:white; margin-top:10px; padding:10px; width:300px; }
#logoutBtn { background:var(--accent-cyan); color:#1A1A2E; padding:10px; margin-bottom:20px; }

.container { max-width:1200px; margin:30px auto; padding:0 20px; width:100%; }
.results-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:25px; width:100%; }
.duo-card { background:var(--card-color); color:#1A1A2E; border-radius:12px; overflow:hidden; border-top:5px solid var(--accent-cyan); transition:.3s; }
.duo-card:hover { transform:translateY(-5px); box-shadow:0 12px 20px rgba(0,255,255,.2); }
.card-header { padding:15px 20px; display:flex; border-bottom:1px solid #edf2f7; }
.avatar { width:50px;height:50px; background:var(--accent-cyan); border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; margin-right:15px; }
.bio { padding:15px 20px; font-size:0.9em; color:#4A5568; }
.action-button { width:100%; padding:12px; background:var(--accent-cyan); color:#1A1A2E; font-weight:bold; margin-bottom:20px; }

.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); justify-content:center; align-items:center; z-index:2000; }
.chat-container { width:400px; height:500px; background:var(--bg-secondary); border-radius:10px; display:flex; flex-direction:column; }
.chat-header { padding:10px 15px; background:#313349; display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid var(--accent-cyan); color:var(--text-light); }
.status-dot { width:8px;height:8px; border-radius:50%; margin-right:8px; background:var(--status-online); }
.message-area { flex:1; padding:15px; overflow-y:auto; }
.message { max-width:80%; margin-bottom:10px; }
.message.self { margin-left:auto; }
.message-content { padding:8px 12px; border-radius:15px; }
.message.other .message-content { background:#4A5568; color:white; }
.message.self .message-content { background:var(--accent-cyan); color:#1A1A2E; }
.chat-input-area { display:flex; padding:15px; }
.chat-input { flex:1; padding:10px; border:none; background:#2D3748; color:white; }
.send-button { padding:10px 15px; border:none; background:var(--accent-cyan); color:#1A1A2E; font-weight:bold; }
.chat-locked { text-align:center; color:var(--text-muted); padding-top:50px; }

.tab-header { display:flex; gap:10px; margin-bottom:20px; }
.tab-header button { padding:8px 15px; background:var(--bg-secondary); color:var(--text-light); font-weight:bold; }
.tab-header button:hover { background:var(--accent-cyan); color:#1A1A2E; }

#tab-profile form { max-width:400px; width:100%; }
</style>
</head>
<body>

<!-- AUTH SECTION -->
<div id="auth-section">
  <h2>Sign In</h2>
  <form id="signin">
    <input id="signin-email" type="email" placeholder="Email" required>
    <input id="signin-password" type="password" placeholder="Password" required>
    <button type="submit">Sign In</button>
  </form>

  <h2>Sign Up</h2>
  <form id="signup">
    <input id="signup-email" type="email" placeholder="Email" required>
    <input id="signup-password" type="password" placeholder="Password" required>
    <button type="submit">Create Account</button>
  </form>

  <button class="google-btn" onclick="googleLogin()">
    <i class="fab fa-google"></i> Continue with Google
  </button>
</div>

<!-- MAIN APP SECTION -->
<div id="app-section" style="display:none;">
  <button id="logoutBtn">Logout</button>

  <div class="tab-header">
    <button onclick="switchTab('home')">Home</button>
    <button onclick="switchTab('profile')">Profile</button>
    <button onclick="switchTab('messages')">Messages</button>
  </div>

  <!-- Tabs -->
  <div id="tab-home">
    <div class="container">
      <div class="results-grid">
        <div class="duo-card">
          <div class="card-header">
            <div class="avatar">LF</div>
            <div>
              <h3>LunarFox_88</h3>
              <p>PS5 & Switch</p>
            </div>
          </div>
          <div class="bio">Casual gamer, co-op focused.</div>
          <button class="action-button" onclick="openChat('LunarFox_88', true)">Send Duo Request</button>
        </div>
      </div>
    </div>
  </div>

  <div id="tab-profile" style="display:none;">
    <h2>Your Profile</h2>
    <form id="profileForm">
      <input type="text" id="profile-username" placeholder="Username" required>
      <select id="profile-platform">
        <option value="PC">PC</option>
        <option value="PS5">PS5</option>
        <option value="Switch">Switch</option>
      </select>
      <input type="text" id="profile-games" placeholder="Games (comma separated)">
      <select id="profile-playstyle">
        <option value="Casual">Casual</option>
        <option value="Competitive">Competitive</option>
      </select>
      <button type="submit">Save Profile</button>
    </form>
  </div>

  <div id="tab-messages" style="display:none;">
    <h2>Messages</h2>
    <p>Click on a duo to chat.</p>
  </div>
</div>

<!-- CHAT MODAL -->
<div id="chatModal" class="modal">
  <div class="chat-container">
    <div id="chatHeader" class="chat-header"></div>
    <div id="messageArea" class="message-area"></div>
    <div class="chat-input-area">
      <input id="chatInput" class="chat-input" placeholder="Type message">
      <button class="send-button" onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDVHxatohLvJNqIHXjf1ZXdmmWX5W1EpNw",
  authDomain: "duoup-cfae6.firebaseapp.com",
  projectId: "duoup-cfae6",
  storageBucket: "duoup-cfae6.firebasestorage.app",
  messagingSenderId: "812263060524",
  appId: "1:812263060524:web:ac09c3ae610db1cd110d89",
  measurementId: "G-46B67F90FK"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// DOM Elements
const authSection = document.getElementById("auth-section");
const appSection = document.getElementById("app-section");
const logoutBtn = document.getElementById("logoutBtn");
const chatModal = document.getElementById('chatModal');
const chatHeader = document.getElementById('chatHeader');
const messageArea = document.getElementById('messageArea');
const chatInput = document.getElementById('chatInput');

let currentDuo = '';
let chatActive = false;

// AUTH
document.getElementById("signup").addEventListener("submit", async e => {
  e.preventDefault();
  const email = document.getElementById("signup-email").value;
  const password = document.getElementById("signup-password").value;
  try { await createUserWithEmailAndPassword(auth, email, password); }
  catch(err){ alert(err.message); }
});

document.getElementById("signin").addEventListener("submit", async e => {
  e.preventDefault();
  const email = document.getElementById("signin-email").value;
  const password = document.getElementById("signin-password").value;
  try { await signInWithEmailAndPassword(auth, email, password); }
  catch(err){ alert(err.message); }
});

window.googleLogin = async () => {
  try {
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
  } catch(err){ alert(err.message); }
};

logoutBtn.addEventListener("click", async () => { await signOut(auth); });

// Show/hide app based on auth
onAuthStateChanged(auth, async user => {
  if(user){
    authSection.style.display = 'none';
    appSection.style.display = 'flex';

    // Load or create profile
    const docRef = doc(db, 'users', user.uid);
    const docSnap = await getDoc(docRef);
    if(docSnap.exists()){
      const data = docSnap.data();
      document.getElementById('profile-username').value = data.username || '';
      document.getElementById('profile-platform').value = data.platform || 'PC';
      document.getElementById('profile-games').value = data.games || '';
      document.getElementById('profile-playstyle').value = data.playstyle || 'Casual';
    } else {
      await setDoc(docRef, {
        username: user.email.split('@')[0],
        platform: 'PC',
        games: '',
        playstyle: 'Casual'
      });
    }

  } else {
    authSection.style.display = 'flex';
    appSection.style.display = 'none';
  }
});

// TAB SWITCHING
const tabHome = document.getElementById('tab-home');
const tabProfile = document.getElementById('tab-profile');
const tabMessages = document.getElementById('tab-messages');

window.switchTab = tab => {
  tabHome.style.display='none';
  tabProfile.style.display='none';
  tabMessages.style.display='none';
  if(tab==='home') tabHome.style.display='block';
  if(tab==='profile') tabProfile.style.display='block';
  if(tab==='messages') tabMessages.style.display='block';
}

// SAVE PROFILE
document.getElementById('profileForm').addEventListener('submit', async e => {
  e.preventDefault();
  const user = auth.currentUser;
  if(!user) return;
  const docRef = doc(db,'users',user.uid);
  await setDoc(docRef,{
    username: document.getElementById('profile-username').value,
    platform: document.getElementById('profile-platform').value,
    games: document.getElementById('profile-games').value,
    playstyle: document.getElementById('profile-playstyle').value
  },{merge:true});
  alert('Profile updated!');
});

// CHAT FUNCTIONS
window.openChat = (duoName, isAccepted) => {
  currentDuo = duoName;
  chatActive = isAccepted;
  chatInput.value='';
  chatInput.disabled = !chatActive;

  chatHeader.innerHTML = chatActive
    ? `<div><span class="status-dot"></span>${duoName} (Online)</div><span onclick="closeChat()">×</span>`
    : `<div style="color:#FFC107;">Request Pending with ${duoName}</div><span onclick="closeChat()">×</span>`;

  messageArea.innerHTML = chatActive
    ? `<div class="message other"><div class="message-content">Hey! Ready to play?</div></div>`
    : `<p class="chat-locked">Chat locked until request accepted.</p>`;

  chatModal.style.display='flex';
}

window.closeChat = () => { chatModal.style.display='none'; }

window.sendMessage = () => {
  if(!chatActive || !chatInput.value.trim()) return;
  messageArea.innerHTML += `<div class="message self"><div class="message-content">${chatInput.value}</div></div>`;
  chatInput.value='';
  messageArea.scrollTop = messageArea.scrollHeight;
}

window.onclick = e => { if(e.target===chatModal) closeChat(); }
</script>
</body>
</html>
