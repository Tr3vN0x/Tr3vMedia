<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Duoup â€“ Professional Gaming Network</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<style>
:root {
  --bg-dark: #0F0F1A;
  --panel: #1A1A2E;
  --cyan: #00FFFF;
  --pink: #FF3366;
  --text: #C0C0D8;
  --text-light: #E0FFFF;
  --border: #33335A;
  --radius: 10px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family: 'Segoe UI', Tahoma, sans-serif;
  background:var(--bg-dark);
  color:var(--text);
  min-height:100vh;
}
.hidden{display:none}

/* NAV */
.navbar{
  display:none;
  justify-content:space-between;
  align-items:center;
  padding:15px 30px;
  background:var(--panel);
  border-bottom:2px solid var(--cyan);
}
.logo{font-size:2rem;color:var(--cyan)}
.nav-link{
  margin-left:20px;
  cursor:pointer;
}
.nav-link:hover{color:var(--cyan)}

/* VIEWS */
.app-view{display:none;padding:30px;animation:fade .3s ease}
@keyframes fade{
  from{opacity:0;transform:translateY(5px)}
  to{opacity:1;transform:none}
}

/* UI */
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
  box-shadow:0 0 10px rgba(0,255,255,.2);
}
.btn{
  background:var(--pink);
  border:none;
  padding:12px 18px;
  font-weight:bold;
  border-radius:var(--radius);
  cursor:pointer;
}
.btn.secondary{background:var(--cyan)}
input{
  width:100%;
  padding:12px;
  margin-bottom:15px;
  background:var(--bg-dark);
  border:1px solid var(--border);
  color:var(--text-light);
  border-radius:var(--radius);
}

/* HOME */
#home-view{display:flex;gap:30px}
.player-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:20px;
}

/* LOADER */
#loader{
  position:fixed;
  inset:0;
  background:rgba(15,15,26,.9);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:3rem;
  color:var(--cyan);
  z-index:999;
}

/* MOBILE */
@media(max-width:900px){
  #home-view{flex-direction:column}
}
</style>
</head>

<body>

<div id="loader" class="hidden">
  <i class="fas fa-circle-notch fa-spin"></i>
</div>

<nav class="navbar" id="nav">
  <div class="logo">ðŸ“¡ Duoup</div>
  <div>
    <span class="nav-link" data-view="home-view">Home</span>
    <span class="nav-link" data-view="profile-view">Profile</span>
    <span class="nav-link" id="logout">Logout</span>
  </div>
</nav>

<!-- SIGNUP -->
<section id="signup-view" class="app-view">
  <div class="card" style="width:350px">
    <h2 style="color:var(--cyan);margin-bottom:20px">Access Network</h2>
    <form id="signup-form">
      <input id="email" type="email" placeholder="Email" required>
      <input id="password" type="password" placeholder="Password" required>
      <input id="username" placeholder="Gamertag" required>
      <input id="game" placeholder="Main Game" required>
      <button class="btn">Authorize</button>
    </form>
  </div>
</section>

<!-- HOME -->
<section id="home-view" class="app-view">
  <div class="card" style="width:260px">
    <h3 style="color:var(--cyan)">Filters</h3>
    <button class="btn secondary" id="refresh">Refresh Feed</button>
  </div>
  <div style="flex:1">
    <h2 style="color:var(--cyan);margin-bottom:20px">Live Duoup Requests</h2>
    <div class="player-grid" id="feed"></div>
  </div>
</section>

<!-- PROFILE -->
<section id="profile-view" class="app-view">
  <div class="card" style="max-width:600px">
    <h2 id="profile-name" style="color:var(--cyan)"></h2>
    <p id="profile-game"></p>
  </div>
</section>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyDVHxatohLvJNqIHXjf1ZXdmmWX5W1EpNw",
  authDomain: "duoup-cfae6.firebaseapp.com",
  projectId: "duoup-cfae6"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* STATE */
const views = document.querySelectorAll('.app-view');
const nav = document.getElementById('nav');
const loader = document.getElementById('loader');

const showLoader = () => loader.classList.remove('hidden');
const hideLoader = () => loader.classList.add('hidden');

function showView(id){
  views.forEach(v=>v.style.display='none');
  document.getElementById(id).style.display='block';
  nav.style.display = id === 'signup-view' ? 'none' : 'flex';
}

/* AUTH */
auth.onAuthStateChanged(async user=>{
  hideLoader();

  if(!user){
    showView('signup-view');
    return;
  }

  const doc = await db.collection('users').doc(user.uid).get();

  if(!doc.exists){
    await auth.signOut();
    showView('signup-view');
    return;
  }

  showView('home-view');
  loadFeed();
});

/* SIGNUP */
document.getElementById('signup-form').onsubmit = async e=>{
  e.preventDefault();
  showLoader();

  try{
    const emailVal = document.getElementById('email').value;
    const passVal = document.getElementById('password').value;
    const userVal = document.getElementById('username').value;
    const gameVal = document.getElementById('game').value;

    const cred = await auth.createUserWithEmailAndPassword(emailVal, passVal);

    await db.collection('users').doc(cred.user.uid).set({
      uid: cred.user.uid,
      username: userVal,
      game: gameVal,
      created: firebase.firestore.FieldValue.serverTimestamp()
    });

  }catch(err){
    alert(err.message);
    console.error(err);
  }finally{
    hideLoader();
  }
};

/* FEED */
async function loadFeed(){
  showLoader();
  const feed = document.getElementById('feed');
  feed.innerHTML = '';

  try{
    const snap = await db.collection('users')
      .orderBy('uid')
      .limit(12)
      .get();

    if(snap.empty){
      feed.innerHTML = '<p>No players found.</p>';
    }

    snap.forEach(doc=>{
      if(doc.id === auth.currentUser.uid) return;
      const u = doc.data();
      feed.innerHTML += `
        <div class="card">
          <h3 style="color:var(--text-light)">${u.username}</h3>
          <p>${u.game}</p>
          <button class="btn">Duo Up</button>
        </div>`;
    });

  }catch(err){
    console.error(err);
    feed.innerHTML = '<p>Error loading feed.</p>';
  }finally{
    hideLoader();
  }
}

/* NAV */
document.addEventListener('click',e=>{
  if(e.target.dataset.view) showView(e.target.dataset.view);
});
document.getElementById('logout').onclick = ()=>auth.signOut();
document.getElementById('refresh').onclick = loadFeed;
</script>
</body>
</html>
