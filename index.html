<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tr3vMedia</title>
<style>
body {margin:0;font-family:'Consolas',monospace;background:#0a0a0a;color:#00ff66;}
header, footer {background:#0d0d0d;padding:15px 30px;color:#00ff66;}
header {display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #003300;position:sticky;top:0;z-index:10;}
.nav-tab {cursor:pointer;padding:8px 12px;border-radius:6px;border:1px solid #003300;margin-left:5px;}
.nav-tab.active {background:#003300;box-shadow:0 0 10px #33ff99;}
main {padding:20px 30px;}
input:not([type="file"]), textarea {
    width: 100%; /* Fix: Make inputs full width */
    box-sizing: border-box;
    padding: 10px;
    margin-bottom: 10px; /* Add space below inputs */
    border-radius:6px;
    background:#111;
    color:#00ff66;
    border:1px solid #003300;
    margin-top:5px;
}
input[type="file"] {margin-top:5px;}
button {
    cursor:pointer;
    padding:10px 15px; /* Fix: Increase button size */
    border-radius:6px;
    background:#111;
    color:#00ff66;
    border:1px solid #003300;
    margin-top:5px;
}
.post {display:flex;align-items:flex-start;gap:10px;background:#111;padding:15px;margin-bottom:10px;border-radius:6px;border:1px solid #003300;}
.post img, #profile-pic {
    width:40px;
    height:40px;
    border-radius:50%;
    border:1px solid #00ff66;
    object-fit:cover;
    background: #0d0d0d; /* Fix: Fallback background for missing images */
}
#profile-pic {width:80px;height:80px;}
.verified {color:#1DA1F2;font-weight:bold;margin-left:5px;}
.tab-content {display:none;}
#welcome-banner {background:#004400;color:white;text-align:center;padding:15px;margin-bottom:20px;}
#new-post button {margin-top: 10px;}
</style>
</head>
<body>

<header>
    <div class="logo-container">
        <strong>Tr3vMedia</strong>
    </div>
    <div class="header-actions" id="header-tabs"></div>
</header>

<div id="welcome-banner"></div>

<main id="main-content">
    <div id="auth" class="tab-content">
        <h2>Login</h2>
        <input type="text" id="login-username" placeholder="Username">
        <input type="password" id="login-password" placeholder="Password">
        <button onclick="login()">Login</button>
        <p>Or <span style="cursor:pointer;color:#33ff99;" onclick="showSignup()">Sign Up</span></p>
    </div>

    <div id="signup" class="tab-content">
        <h2>Sign Up</h2>
        <input type="text" id="signup-username" placeholder="Username">
        <input type="password" id="signup-password" placeholder="Password">
        <button onclick="signup()">Create Account</button>
        <p>Or <span style="cursor:pointer;color:#33ff99;" onclick="showLogin()">Login</span></p>
    </div>

    <div id="home" class="tab-content">
        <div id="new-post">
            <textarea id="post-text" rows="3" placeholder="What's on your mind?"></textarea>
            <button onclick="addPost()">Post</button>
        </div>
        <div id="posts"></div>
    </div>

    <div id="profile" class="tab-content">
        <h2>Profile</h2>
        <img id="profile-pic" src="" alt="Profile Picture"><br>
        <input type="file" id="profile-upload" accept="image/*"><br>
        <textarea id="profile-bio" placeholder="Write your bio..."></textarea><br>
        <button onclick="saveProfile()">Save Profile</button>
        <p>Username: <span id="profile-username"></span> <span id="owner-tag"></span></p>
        <p>Posts: <span id="profile-posts-count"></span></p>
    </div>

    <div id="settings" class="tab-content">
        <h2>Settings</h2>
        <label>Change username: <input type="text" id="change-username"></label><br>
        <button onclick="changeUsername()">Save</button>
    </div>
</main>

<footer>&copy; 2025 Tr3vMedia — All Rights Reserved</footer>

<script>
// ------------------ Users Setup ------------------
if(!localStorage.getItem('users')) {
    const defaultUsers = {
        'Tr3vN0x': {password:'ownerpass', profilePic:'https://via.placeholder.com/60', bio:'Owner of Tr3vMedia', posts:[]}
    };
    localStorage.setItem('users', JSON.stringify(defaultUsers));
}

// ------------------ Auth Tabs ------------------
function showLogin() {document.getElementById('signup').style.display='none'; document.getElementById('auth').style.display='block';}
function showSignup() {document.getElementById('auth').style.display='none'; document.getElementById('signup').style.display='block';}

// ------------------ Signup / Login ------------------
function signup(){
    const username = document.getElementById('signup-username').value.trim();
    const password = document.getElementById('signup-password').value.trim();
    if(!username||!password){alert("Fill all fields"); return;}
    const users = JSON.parse(localStorage.getItem('users'));
    if(users[username]){alert("Username taken"); return;}
    // Set a default profile pic for new users
    users[username]={password,profilePic:'https://via.placeholder.com/60',bio:'',posts:[]}; 
    localStorage.setItem('users', JSON.stringify(users));
    alert("Account created! Login now.");
    showLogin();
}
function login(){
    const username = document.getElementById('login-username').value.trim();
    const password = document.getElementById('login-password').value.trim();
    const users = JSON.parse(localStorage.getItem('users'));
    if(!users[username] || users[username].password!==password){alert("Invalid credentials"); return;}
    localStorage.setItem('currentUser', username);
    initApp();
}

// ------------------ App Init ------------------
function initApp(){
    document.getElementById('auth').style.display='none';
    document.getElementById('signup').style.display='none';
    
    document.getElementById('welcome-banner').innerText=`Hello ${localStorage.getItem('currentUser')}!`;
    
    // Fix: Redraw all header tabs with correct onclick for robust switching
    document.getElementById('header-tabs').innerHTML=`
        <div class="nav-tab" onclick="showTab('home')">Home</div>
        <div class="nav-tab" onclick="showTab('profile')">Profile</div>
        <div class="nav-tab" onclick="showTab('settings')">Settings</div>
        <div class="nav-tab" onclick="logout()">Logout</div>`;
    
    loadUser();
    showTab('home'); // Fix: Ensure 'home' is the initial active tab
}

// ------------------ Logout ------------------
function logout(){localStorage.removeItem('currentUser'); location.reload();}

// ------------------ Tab Switching ------------------
function showTab(tabId){
    document.querySelectorAll('.tab-content').forEach(tab=>tab.style.display='none');
    document.getElementById(tabId).style.display='block';
    
    document.querySelectorAll('.nav-tab').forEach(tab=>tab.classList.remove('active'));
    
    // Fix: Select the tab based on the tabId argument passed
    const activeTabElement = document.querySelector(`.nav-tab[onclick*="showTab('${tabId}')"]`);
    if (activeTabElement) {
        activeTabElement.classList.add('active');
    }
}

// ------------------ Profile ------------------
function loadUser(){
    const users=JSON.parse(localStorage.getItem('users'));
    const currentUser=localStorage.getItem('currentUser');
    if(!currentUser) return;
    const user = users[currentUser];
    // Fix: Ensure profile pic is set
    document.getElementById('profile-pic').src=user.profilePic;
    document.getElementById('profile-username').innerText=currentUser;
    document.getElementById('profile-posts-count').innerText=user.posts.length;
    document.getElementById('owner-tag').innerHTML=currentUser==='Tr3vN0x'?'<span class="verified">✔️ Owner</span>':'';
    document.getElementById('profile-bio').value=user.bio;
    renderPosts();
}

document.getElementById('profile-upload').addEventListener('change', function(){
    const file = this.files[0]; if(file){
        const reader = new FileReader();
        reader.onload=function(){
            const users=JSON.parse(localStorage.getItem('users'));
            const currentUser=localStorage.getItem('currentUser');
            users[currentUser].profilePic=reader.result;
            localStorage.setItem('users',JSON.stringify(users));
            document.getElementById('profile-pic').src=reader.result;
            renderPosts();
        };
        reader.readAsDataURL(file);
    }
});

function saveProfile(){
    const users=JSON.parse(localStorage.getItem('users'));
    const currentUser=localStorage.getItem('currentUser');
    users[currentUser].bio=document.getElementById('profile-bio').value;
    localStorage.setItem('users',JSON.stringify(users));
    alert("Profile saved!");
}

// ------------------ Posts ------------------
function addPost(){
    const text=document.getElementById('post-text').value.trim();
    if(!text){alert("Cannot post empty"); return;}
    const users=JSON.parse(localStorage.getItem('users'));
    const currentUser=localStorage.getItem('currentUser');
    users[currentUser].posts.unshift({text,date:Date.now()});
    localStorage.setItem('users',JSON.stringify(users));
    document.getElementById('post-text').value='';
    // Fix: Ensure profile count updates after a post
    document.getElementById('profile-posts-count').innerText=users[currentUser].posts.length; 
    renderPosts();
}

function renderPosts(){
    const postsDiv=document.getElementById('posts'); postsDiv.innerHTML='';
    const users=JSON.parse(localStorage.getItem('users'));
    const allPosts=[];
    for(let user in users){users[user].posts.forEach(p=>allPosts.push({user,text:p.text,date:p.date,profilePic:users[user].profilePic}));}
    allPosts.sort((a,b)=>b.date-a.date);
    allPosts.forEach(p=>{
        const div=document.createElement('div'); div.className='post';
        div.innerHTML=`<img src="${p.profilePic}" alt="${p.user}'s profile picture"><div><strong>${p.user}${p.user==='Tr3vN0x'?'<span class="verified">✔️ Owner</span>':''}:</strong> ${p.text}</div>`;
        postsDiv.appendChild(div);
    });
}

// ------------------ Settings ------------------
function changeUsername(){
    const newName=document.getElementById('change-username').value.trim();
    if(!newName) return alert("Username cannot be empty");
    const users=JSON.parse(localStorage.getItem('users'));
    const currentUser=localStorage.getItem('currentUser');
    if(users[newName]) return alert("Username taken");
    
    // Fix: Prevent the owner from changing the username, as it's the anchor for the 'Owner' badge logic
    if (currentUser === 'Tr3vN0x') return alert("The owner's username cannot be changed.");
    
    users[newName]=users[currentUser]; delete users[currentUser];
    localStorage.setItem('users',JSON.stringify(users));
    localStorage.setItem('currentUser',newName);
    
    // Update the UI
    document.getElementById('change-username').value = '';
    loadUser();
    
    alert("Username changed! Please refresh to ensure all elements update.");
}

// ------------------ Check login on reload ------------------
if(localStorage.getItem('currentUser')) initApp(); else {showLogin();}
</script>

</body>
</html>
