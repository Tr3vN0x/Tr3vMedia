<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUO UP Simulation</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
/* --- BASE STYLES --- */
body { 
    margin:0; 
    font-family:'Orbitron',sans-serif; 
    background:#0b0b0b; 
    color:white; 
}
.container { width:90%; max-width: 1000px; margin:auto; padding:20px; }
.hidden { display:none; }

/* --- HEADER & ICON STYLES --- */
.header {
    background: #111;
    border-bottom: 3px solid cyan;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
    padding: 10px 0;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.header h1 {
    font-size: 2.5em;
    color: #fff;
    text-shadow: 0 0 5px cyan, 0 0 10px cyan, 0 0 15px magenta;
    margin: 0;
}
.icon-container {
    margin-right: 15px;
    font-size: 2.5em;
    color: cyan;
    text-shadow: 0 0 5px cyan, 0 0 10px magenta;
}

/* --- BUTTON STYLES --- */
.neon-btn { 
    border:2px solid cyan; 
    background:transparent; 
    color:white; 
    padding:8px 14px; 
    margin:5px; 
    border-radius:6px; 
    cursor:pointer; 
    box-shadow:0 0 10px cyan; 
    transition: all 0.2s ease-in-out;
    text-transform: uppercase;
    font-family: 'Orbitron', sans-serif; 
}
.neon-btn:hover { border-color:magenta; box-shadow:0 0 15px magenta; }
.neon-btn.remove { border-color: red; box-shadow: 0 0 10px red; }
.neon-btn.remove:hover { border-color: orange; box-shadow: 0 0 15px orange; }

/* --- CARD/LAYOUT STYLES --- */
.flex { display:flex; gap:15px; flex-wrap:wrap; }
.card-container {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
}
.card { 
    width:250px; 
    padding:15px; 
    border:2px solid cyan; 
    border-radius:12px; 
    background:#111; 
    box-shadow:0 0 10px cyan; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    margin-bottom: 15px;
    cursor: pointer; 
}
.card-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    margin-bottom: 10px; /* Space before buttons */
}
.avatar { width:50px; height:50px; border-radius:50%; border:2px solid cyan; object-fit:cover; margin-bottom:10px; }

/* --- RATING AND STATUS STYLES --- */
.skill-rating {
    color: gold; 
    font-size: 1.2em;
    margin-bottom: 5px;
}
.status-indicator {
    font-size: 0.8em;
    padding: 3px 8px;
    border-radius: 4px;
    font-weight: bold;
    margin-bottom: 10px;
}
.status-online { background-color: #00cc00; color: #0b0b0b; box-shadow: 0 0 5px #00ff00; }
.status-lfd { background-color: #00aaff; color: #0b0b0b; box-shadow: 0 0 5px #00aaff; }

/* --- MESSAGE STYLES --- */
.profile-section h3 {
    border-bottom: 1px solid magenta;
    padding-bottom: 5px;
}
.profile-header {
    display: flex;
    gap: 20px;
    align-items: center;
    border: 1px solid #333;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    background: #181818;
}
.profile-header img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid cyan;
    object-fit: cover;
}
.game-tag {
    display: inline-block;
    background: #222;
    border: 1px solid #444;
    padding: 5px 10px;
    margin-right: 8px;
    margin-bottom: 8px;
    border-radius: 4px;
    font-size: 0.9em;
}
.message-container { 
    background: #181818; 
    border-radius: 8px; 
    padding: 15px; 
    margin-top: 15px; 
    border: 1px solid #333;
}
.message-item {
    border-bottom: 1px dashed #444;
    padding: 10px 0;
}
.message-item:last-child { border-bottom: none; }
.message-header { font-size: 0.9em; color: cyan; margin-bottom: 5px; }
.message-body { font-size: 1em; }

/* --- UNREAD COUNT BADGE --- */
.unread-badge {
    background-color: magenta;
    color: white;
    border-radius: 50%;
    padding: 2px 7px;
    margin-left: 5px;
    font-size: 0.7em;
    font-weight: bold;
    box-shadow: 0 0 5px magenta;
}
</style>
</head>
<body>

<div class="header">
    <div class="icon-container">⚡</div>
    <h1>DUO UP SIMULATION</h1>
</div>

<div id="dashboard" class="container">
  <h2 id="welcome">Welcome, PlayerOne!</h2>
  <div style="margin-bottom: 20px;">
    <button class="neon-btn" onclick="showTab('suggested')">Suggested</button>
    <button class="neon-btn" onclick="showTab('requests')">Requests</button>
    <button id="friendsBtn" class="neon-btn" onclick="showTab('friends')">
        Friends <span id="unreadBadge" class="unread-badge hidden">0</span>
    </button>
  </div>

  <div id="suggestedTab">
    <h3>Suggested Players</h3>
    <div id="suggestedCards" class="card-container">
        </div>
  </div>
  <div id="requestsTab" class="flex hidden">
    <h3>Friend Requests</h3>
  </div>
  <div id="friendsTab" class="flex hidden">
    <h3>My Friends</h3>
  </div>

  <div id="profileViewer" class="container hidden">
    </div>
</div>


<script>
// --- CLIENT-SIDE DATA SIMULATION ---
const DEFAULT_AVATAR = "https://cdn-icons-png.flaticon.com/512/149/149071.png";

const mockUserData = {
    // Current User (The one viewing the app)
    "user_1": {
        uid: "user_1",
        nickname: "PlayerOne",
        profileImageUrl: "https://i.pravatar.cc/100?img=1",
        bio: "Veteran gamer looking for a reliable League duo. Must have mic and a positive attitude!",
        games: ["League of Legends", "Valorant", "Rocket League"],
        skillRating: 4,
        status: "Looking for Duo",
        friends: ["user_3"], // Friends list starts with user_3
        nicknames: {},
    },
    // Other Users (Suggested)
    "user_2": {
        uid: "user_2",
        nickname: "CyberPhoenix",
        profileImageUrl: "https://i.pravatar.cc/100?img=2",
        bio: "Apex Legends main, usually playing aggressively. Ready to climb the ranks.",
        games: ["Apex Legends", "Valorant"],
        skillRating: 5,
        status: "Online",
        friends: [],
        nicknames: {},
    },
    "user_3": {
        uid: "user_3",
        nickname: "StarWarp",
        profileImageUrl: "https://i.pravatar.cc/100?img=3",
        bio: "Casual Minecraft builder. Just looking for chill people to hang out with.",
        games: ["Minecraft", "Genshin Impact"],
        skillRating: 2,
        status: "Online",
        friends: ["user_1"],
        nicknames: {},
    },
    "user_4": {
        uid: "user_4",
        nickname: "NeonBlade",
        profileImageUrl: "https://i.pravatar.cc/100?img=4",
        bio: "Overwatch tank main, reliable and consistent.",
        games: ["Overwatch 2"],
        skillRating: 3,
        status: "Online",
        friends: [],
        nicknames: {},
    },
};

// SIMULATED DATABASE TABLES
let currentUser = mockUserData["user_1"];
let mockFriendRequests = []; // Stores { senderId: 'user_X', receiverId: 'user_Y' }
let mockMessages = [
    { senderId: 'user_3', receiverId: 'user_1', content: "Hey! Ready for a match tonight?", timestamp: Date.now() - 3600000, read: false },
    { senderId: 'user_1', receiverId: 'user_3', content: "Sounds good! Which game?", timestamp: Date.now() - 1800000, read: true },
    { senderId: 'user_3', receiverId: 'user_1', content: "League, maybe? I need to climb Mid.", timestamp: Date.now() - 60000, read: false }
];

// ---------------- HELPER FUNCTIONS ----------------

function renderSkillRating(rating) {
    rating = parseInt(rating) || 0;
    const filledStars = '⭐'.repeat(rating);
    const emptyStars = '☆'.repeat(5 - rating);
    return `<div class="skill-rating" title="Skill Rating: ${rating}/5">${filledStars}${emptyStars}</div>`;
}

function renderStatus(status) {
    let statusClass = '';
    let displayStatus = status || 'Away';
    
    if (displayStatus === 'Online') {
        statusClass = 'status-online';
    } else if (displayStatus === 'Looking for Duo') {
        statusClass = 'status-lfd';
    } else {
        statusClass = '';
    }
    return `<div class="status-indicator ${statusClass}">${displayStatus}</div>`;
}

function getFriendNickname(friendId) {
    return currentUser.nicknames[friendId] || mockUserData[friendId].nickname;
}

// ---------------- UI MANAGEMENT ----------------

function hideAllTabs() {
    document.getElementById("suggestedTab").classList.add("hidden");
    document.getElementById("requestsTab").classList.add("hidden");
    document.getElementById("friendsTab").classList.add("hidden");
    document.getElementById("profileViewer").classList.add("hidden");
}

function showTab(tab) {
    hideAllTabs();
    document.getElementById("dashboard").classList.remove("hidden");

    const tabElement = document.getElementById(tab + "Tab");
    if (tabElement) {
        tabElement.classList.remove("hidden");
    }

    if (tab === 'suggested') {
        loadSuggested();
    } else if (tab === 'requests') {
        loadRequests();
    } else if (tab === 'friends') {
        loadFriends();
    }
}

// Initialize the app view
function init() {
    loadUnreadCount();
    showTab('suggested');
}


// ---------------- MESSAGE FUNCTIONS ----------------

function loadUnreadCount() {
    const unreadCount = mockMessages.filter(msg => 
        msg.receiverId === currentUser.uid && msg.read === false
    ).length;
    
    const badge = document.getElementById('unreadBadge');
    if (unreadCount > 0) {
        badge.textContent = unreadCount;
        badge.classList.remove('hidden');
    } else {
        badge.classList.add('hidden');
    }
}

function sendMessage(receiverId) {
    const messageContent = prompt("Enter your message (max 150 chars):");
    if (messageContent === null || messageContent.trim() === "") return;
    
    const trimmedContent = messageContent.trim().substring(0, 150);

    const newMsg = {
        senderId: currentUser.uid,
        receiverId: receiverId,
        content: trimmedContent,
        timestamp: Date.now(),
        read: false 
    };
    mockMessages.push(newMsg);
    
    alert("Message sent!");
    // Re-render the profile viewer to show the new message
    viewProfile(receiverId);
}

function loadMessagesForProfile(targetUserId) {
    const targetNickname = mockUserData[targetUserId].nickname;
    const messageContainer = document.getElementById('messageInbox');
    
    // Filter messages between current user and target user
    const conversation = mockMessages.filter(msg => 
        (msg.senderId === currentUser.uid && msg.receiverId === targetUserId) ||
        (msg.senderId === targetUserId && msg.receiverId === currentUser.uid)
    );

    // Sort by timestamp (most recent first)
    conversation.sort((a, b) => b.timestamp - a.timestamp);

    if (conversation.length === 0) {
        messageContainer.innerHTML = '<p style="text-align: center; opacity: 0.7;">No messages exchanged yet.</p>';
    }

    let messageHtml = '';
    
    conversation.forEach(msg => {
        const sender = msg.senderId === currentUser.uid ? "You" : targetNickname;
        const senderColor = msg.senderId === currentUser.uid ? 'cyan' : 'magenta';
        const date = new Date(msg.timestamp).toLocaleString();
        
        messageHtml += `
            <div class="message-item">
                <div class="message-header" style="color:${senderColor};">
                    ${sender} @ ${date}
                </div>
                <div class="message-body">${msg.content}</div>
            </div>
        `;
        
        // Mark incoming messages as read in the mockMessages array
        if (msg.receiverId === currentUser.uid && msg.read === false) {
            msg.read = true;
        }
    });

    messageContainer.innerHTML = `
        <button class="neon-btn" onclick="sendMessage('${targetUserId}')" style="margin-bottom: 10px; width: 100%;">Send New Message to ${targetNickname}</button>
        ${messageHtml}`;
        
    loadUnreadCount(); // Update the badge after marking messages as read
}


// ---------------- PROFILE VIEWER LOGIC ----------------

function viewProfile(targetUserId) {
    hideAllTabs();
    document.getElementById("profileViewer").classList.remove("hidden");
    
    const u = mockUserData[targetUserId];
    if (!u) {
        document.getElementById("profileViewer").innerHTML = `<p style="color:red; text-align: center;">Error: User profile not found.</p>`;
        return;
    }

    const gamesList = (u.games || []).map(g => `<span class="game-tag">${g}</span>`).join('');
    const bioText = u.bio || "No biography provided.";
    const isFriend = currentUser.friends.includes(targetUserId);
    
    // Check for pending requests
    const pendingRequest = mockFriendRequests.find(r => 
        (r.senderId === currentUser.uid && r.receiverId === targetUserId) || 
        (r.senderId === targetUserId && r.receiverId === currentUser.uid)
    );

    let actionButtonHTML = '';
    if (isFriend) {
        actionButtonHTML = `<button class="neon-btn" onclick="sendMessage('${targetUserId}');">Send Message</button>
                            <button class="neon-btn remove" onclick="removeFriend('${targetUserId}')">Remove Friend</button>`;
    } else if (pendingRequest) {
        actionButtonHTML = '<button class="neon-btn" style="border-color: yellow; box-shadow: 0 0 10px yellow; cursor: default;">Request Pending</button>';
    } else {
        actionButtonHTML = `<button class="neon-btn" onclick="sendRequest('${targetUserId}')">Send Request</button>`;
    }

    const statusHtml = renderStatus(u.status);
    const ratingHtml = renderSkillRating(u.skillRating);


    document.getElementById("profileViewer").innerHTML = `
        <button class="neon-btn" style="margin-bottom: 20px;" onclick="showTab('suggested')">← Back to Suggested</button>

        <div class="profile-header">
            <img src="${u.profileImageUrl || DEFAULT_AVATAR}" alt="${u.nickname}">
            <div>
                <h2>${u.nickname}</h2>
                ${statusHtml}
                ${ratingHtml}
                <div style="margin-top: 10px;">${actionButtonHTML}</div>
            </div>
        </div>

        <div class="profile-section">
            <h3>Bio</h3>
            <p>${bioText}</p>
        </div>

        <div class="profile-section">
            <h3>Favorite Games</h3>
            <div>${gamesList || '<p>No favorite games listed.</p>'}</div>
        </div>
        
        ${isFriend ? `
            <div class="profile-section">
                <h3>Messages with ${u.nickname}</h3>
                <div id="messageInbox" class="message-container"></div>
            </div>
        ` : ''}
    `;
    
    if (isFriend) {
        loadMessagesForProfile(targetUserId);
    }
}

// ---------------- LOAD FUNCTIONS ----------------

function loadSuggested(){
    const suggestedCards = document.getElementById("suggestedCards");
    suggestedCards.innerHTML = "";
    let suggestedCount = 0;

    const myFriends = currentUser.friends;
    const pendingIds = mockFriendRequests.map(r => r.senderId === currentUser.uid ? r.receiverId : r.senderId);

    // Filter out self, friends, and pending users
    Object.values(mockUserData).forEach(u => {
        if (u.uid === currentUser.uid) return;
        if (myFriends.includes(u.uid)) return;
        if (pendingIds.includes(u.uid)) return;

        const card = document.createElement("div");
        card.className = "card";
        card.setAttribute('onclick', `viewProfile('${u.uid}')`);
        
        const gamesPreview = (u.games && u.games.length > 0) ? `<p style="font-size:0.8em; margin: 5px 0;">Games: ${u.games.slice(0, 2).join(', ')}...</p>` : '';
        const ratingHtml = renderSkillRating(u.skillRating);
        const statusHtml = renderStatus(u.status);

        card.innerHTML = `
            <div class="card-content">
                <img class="avatar" src="${u.profileImageUrl||DEFAULT_AVATAR}">
                <strong>${u.nickname}</strong>
                ${ratingHtml}
                ${statusHtml}
                ${gamesPreview}
            </div>
            <button class="neon-btn" onclick="event.stopPropagation(); viewProfile('${u.uid}')">View & Request</button>
        `;
        suggestedCards.appendChild(card);
        suggestedCount++;
    });

    if (suggestedCount === 0) {
        suggestedCards.innerHTML=`<p>No suggested players available right now.</p>`;
    }
}

function loadRequests(){
    const requestsTab = document.getElementById("requestsTab");
    requestsTab.innerHTML = "<h3>Friend Requests</h3>";

    // Filter requests where current user is the receiver
    const incomingRequests = mockFriendRequests.filter(r => r.receiverId === currentUser.uid);

    if (incomingRequests.length === 0) {
        requestsTab.innerHTML += "<p>No friend requests</p>";
        return;
    }

    incomingRequests.forEach(r => {
        const u = mockUserData[r.senderId];
        if (!u) return; 

        const card = document.createElement("div");
        card.className = "card";
        card.setAttribute('onclick', `viewProfile('${r.senderId}')`);

        const gamesPreview = (u.games && u.games.length > 0) ? `<p style="font-size:0.8em; margin: 5px 0;">Games: ${u.games.slice(0, 2).join(', ')}...</p>` : '';
        const ratingHtml = renderSkillRating(u.skillRating);
        const statusHtml = renderStatus(u.status);

        card.innerHTML = `
            <div class="card-content">
                <img class="avatar" src="${u.profileImageUrl||DEFAULT_AVATAR}">
                <strong>${u.nickname}</strong>
                ${ratingHtml}
                ${statusHtml}
                ${gamesPreview}
            </div>
            <button class="neon-btn" onclick="event.stopPropagation(); acceptRequest('${r.senderId}')">Accept</button>
            <button class="neon-btn" onclick="event.stopPropagation(); rejectRequest('${r.senderId}')">Reject</button>
        `;
        requestsTab.appendChild(card);
    });
}

function loadFriends(){
    const friendsTab = document.getElementById("friendsTab");
    friendsTab.innerHTML = "<h3>My Friends</h3>";

    const myFriends = currentUser.friends || [];

    if(myFriends.length === 0){ 
        friendsTab.innerHTML += "<p>No friends yet. Time to find a duo!</p>"; 
        return; 
    }
    
    myFriends.forEach(friendId => {
        const u = mockUserData[friendId];
        if (!u) return; 

        const card = document.createElement("div");
        card.className = "card";
        card.setAttribute('onclick', `viewProfile('${friendId}')`);

        const displayNickname = getFriendNickname(friendId);

        const gamesPreview = (u.games && u.games.length > 0) ? `<p style="font-size:0.8em; margin: 5px 0;">Games: ${u.games.slice(0, 2).join(', ')}...</p>` : '';
        const ratingHtml = renderSkillRating(u.skillRating);
        const statusHtml = renderStatus(u.status);

        card.innerHTML = `
            <div class="card-content">
                <img class="avatar" src="${u.profileImageUrl||DEFAULT_AVATAR}">
                <strong>${displayNickname}</strong>
                ${ratingHtml}
                ${statusHtml}
                ${gamesPreview}
            </div>
            <button class="neon-btn" onclick="event.stopPropagation(); viewProfile('${friendId}')">View Profile & Chat</button>
            <button class="neon-btn remove" onclick="event.stopPropagation(); removeFriend('${friendId}')">Remove</button>
        `;
        friendsTab.appendChild(card);
    });
}


// ---------------- FRIEND ACTIONS ----------------

function sendRequest(receiverId){
    const existingRequest = mockFriendRequests.find(r => 
        (r.senderId === currentUser.uid && r.receiverId === receiverId) ||
        (r.senderId === receiverId && r.receiverId === currentUser.uid)
    );

    if (existingRequest) {
        alert("A friend request is already pending with this user!");
        return; 
    }

    mockFriendRequests.push({
        senderId: currentUser.uid,
        receiverId: receiverId
    });
    
    alert("Request sent!"); 
    // Return to the suggested list to re-render the card with the 'Pending' status.
    showTab('suggested'); 
}

function acceptRequest(senderId){
    const requestId = mockFriendRequests.findIndex(r => r.senderId === senderId && r.receiverId === currentUser.uid);
    if (requestId === -1) return; // Should not happen

    // 1. Add friends to both lists
    currentUser.friends.push(senderId);
    mockUserData[senderId].friends.push(currentUser.uid);

    // 2. Remove request
    mockFriendRequests.splice(requestId, 1);
    
    alert(`Request from ${mockUserData[senderId].nickname} accepted! You are now friends.`);
    
    // 3. Re-render the friends and suggested tabs
    showTab('friends'); 
}

function rejectRequest(senderId){
    const requestId = mockFriendRequests.findIndex(r => r.senderId === senderId && r.receiverId === currentUser.uid);
    if (requestId === -1) return; 

    mockFriendRequests.splice(requestId, 1);
    
    alert("Request rejected.");
    showTab('requests');
}

function removeFriend(friendId){
    if(!confirm("Are you sure you want to remove this friend?")) {
        // If user is currently viewing the profile, stay there. Otherwise, go to friends tab.
        const currentView = document.getElementById("profileViewer").classList.contains("hidden") ? 'friends' : 'suggested';
        showTab(currentView);
        return;
    }

    // Remove from current user's list
    currentUser.friends = currentUser.friends.filter(id => id !== friendId);
    
    // Remove from friend's list
    mockUserData[friendId].friends = mockUserData[friendId].friends.filter(id => id !== currentUser.uid);

    alert("Friend removed successfully.");
    showTab('friends'); 
}

// Start the simulation when the script loads
init();
</script>
</body>
</html>
